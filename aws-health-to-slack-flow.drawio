<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="5.0" version="21.0.0" etag="drawio" type="device">
  <diagram name="AWS Health to Slack Flow" id="flow-diagram">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- AWS Health Service -->
        <mxCell id="aws-health" value="AWS Health Service&#xa;(Personal Health Dashboard)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF9900;strokeColor=#232F3E;fontColor=#FFFFFF;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="360" width="180" height="80" as="geometry" />
        </mxCell>
        
        <!-- EventBridge Rule -->
        <mxCell id="eventbridge" value="EventBridge Rule&#xa;aws-health-events&#xa;&#xa;Source: aws.health&#xa;Detail-type: AWS Health Event" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF4F8B;strokeColor=#232F3E;fontColor=#FFFFFF;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="360" width="200" height="100" as="geometry" />
        </mxCell>
        
        <!-- Lambda Function -->
        <mxCell id="lambda" value="Lambda Function&#xa;aws-health-to-slack&#xa;&#xa;Runtime: Python 3.11&#xa;Handler: handler.handler" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FF9900;strokeColor=#232F3E;fontColor=#FFFFFF;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="540" y="360" width="200" height="100" as="geometry" />
        </mxCell>
        
        <!-- Channel Routing Logic -->
        <mxCell id="routing" value="Channel Routing Logic&#xa;&#xa;1. Extract account ID from event&#xa;2. Lookup in account_application_mapping&#xa;3. Get application &amp; environment&#xa;4. Check channel_routing override&#xa;5. Use template or default channel" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#146EB4;strokeColor=#232F3E;fontColor=#FFFFFF;align=left;verticalAlign=top;spacingLeft=10;spacingTop=10" vertex="1" parent="1">
          <mxGeometry x="540" y="500" width="200" height="140" as="geometry" />
        </mxCell>
        
        <!-- Slack Webhook -->
        <mxCell id="slack" value="Slack Incoming Webhook" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4A154B;strokeColor=#232F3E;fontColor=#FFFFFF;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="800" y="360" width="180" height="80" as="geometry" />
        </mxCell>
        
        <!-- Slack Channels -->
        <mxCell id="channels" value="Slack Channels&#xa;&#xa;#aws-health-DUP-dev&#xa;#aws-health-DUP-prod&#xa;#aws-health-DPS-dev&#xa;#aws-health-DPS-prod&#xa;#infra-alerts (default)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4A154B;strokeColor=#232F3E;fontColor=#FFFFFF;align=left;verticalAlign=top;spacingLeft=10;spacingTop=10" vertex="1" parent="1">
          <mxGeometry x="800" y="480" width="180" height="160" as="geometry" />
        </mxCell>
        
        <!-- Configuration Box -->
        <mxCell id="config" value="Configuration&#xa;&#xa;account_application_mapping:&#xa;  &quot;111111111111&quot; → DUP/dev&#xa;  &quot;222222222222&quot; → DUP/prod&#xa;  &quot;333333333333&quot; → DPS/dev&#xa;&#xa;channel_routing: (optional)&#xa;  DUP/dev → custom channel&#xa;&#xa;slack_channel_template:&#xa;  #aws-health-{app}-{env}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5DBDB;strokeColor=#232F3E;align=left;verticalAlign=top;spacingLeft=10;spacingTop=10;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="40" y="500" width="200" height="200" as="geometry" />
        </mxCell>
        
        <!-- Arrows -->
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#232F3E" edge="1" parent="1" source="aws-health" target="eventbridge">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="400" as="sourcePoint" />
            <mxPoint x="350" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow2" value="Triggers" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#232F3E;labelBackgroundColor=#FFFFFF" edge="1" parent="1" source="eventbridge" target="lambda">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow3" value="Processes Event" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#232F3E;labelBackgroundColor=#FFFFFF" edge="1" parent="1" source="lambda" target="routing">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="640" y="460" as="sourcePoint" />
            <mxPoint x="640" y="500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow4" value="Posts Message" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#232F3E;labelBackgroundColor=#FFFFFF" edge="1" parent="1" source="lambda" target="slack">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="740" y="400" as="sourcePoint" />
            <mxPoint x="800" y="400" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow5" value="Routes to Channel" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#232F3E;labelBackgroundColor=#FFFFFF" edge="1" parent="1" source="slack" target="channels">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="890" y="440" as="sourcePoint" />
            <mxPoint x="890" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="arrow6" value="Reads Config" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;strokeColor=#146EB4;strokeDashArray=5 5;labelBackgroundColor=#FFFFFF" edge="1" parent="1" source="routing" target="config">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="540" y="570" as="sourcePoint" />
            <mxPoint x="240" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Title -->
        <mxCell id="title" value="AWS Health to Slack Integration Flow" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="40" width="400" height="40" as="geometry" />
        </mxCell>
        
        <!-- Flow Description -->
        <mxCell id="description" value="1. AWS Health Service generates health events&#xa;2. EventBridge rule captures events matching aws.health source&#xa;3. Lambda function is triggered with the event&#xa;4. Lambda extracts account ID and looks up application/environment mapping&#xa;5. Channel is determined based on routing rules or template&#xa;6. Message is posted to appropriate Slack channel via webhook" style="text;html=1;strokeColor=none;fillColor=#F4F4F4;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;spacingLeft=10;spacingTop=10;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="40" y="100" width="940" height="120" as="geometry" />
        </mxCell>
        
        <!-- Account Examples -->
        <mxCell id="examples" value="Example Account Routing:&#xa;&#xa;Account 111111111111 (DUP/dev) → #aws-health-DUP-dev&#xa;Account 222222222222 (DUP/prod) → #aws-health-DUP-prod&#xa;Account 999999999999 (not mapped) → #infra-alerts (default)" style="text;html=1;strokeColor=none;fillColor=#E8F4F8;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;spacingLeft=10;spacingTop=10;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="40" y="240" width="940" height="80" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>

